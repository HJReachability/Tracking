% !TEX root = tracking.tex
\section{Numerical examples}

\subsection{5D-3D example with FSM planner \label{sec:reach_planner}}
Consider the 5D car model and the Dubins car dynamics as follows:

\subsubsection{Offline computation}
\subsubsection{Online sensing and planning with FSM }
\begin{equation}
\label{eq:5D_and_3D_dyn}
\begin{aligned}
\begin{array}{c}
\left[
\begin{array}{c}
\dot x\\
\dot y\\
\dot\theta\\
\dot v\\
\dot \omega
\end{array}
\right]
=
\left[
\begin{array}{c}
v \cos \theta + d_x\\
v \sin \theta + d_y\\
\omega \\
a\\
\alpha
\end{array}
\right], \quad
\left[
\begin{array}{c}
\dot \hat x\\
\dot \hat y\\
\dot \hat \theta\\
\end{array}
\right] 
=
\left[
\begin{array}{c}
\hat v \cos \theta\\
\hat v \sin \theta\\
\hat \omega
\end{array}
\right],
\end{array}\\
\end{aligned}
\end{equation}

\noindent where $(x,y,\theta),(\hat x, \hat y, \hat\theta)$ represent the pose (position and heading) of the 5D car model and the Dubins car model respectively. The speed and turn rate $(v, \omega)$ are states for the 5D car model; for the Dubins car the speed $\hat v$ is a constant, and the turn rate $\hat \omega$ is the control. The control of the 5D car consists of the linear and angular acceleration, $(a, \alpha)$.

We define a coordinate system $(x_r, y_r, \theta_r, v, \omega)$ such that $(x_r, y_r, \theta_r)$ is the position and heading of the 5D car in the frame of the Dubins car, as shown in Figure \cite{}, and $(v, \omega)$ represents the speed and turn rate of the 5D car. Following \cite{Mitchell05} for the time derivative of $(x_r, y_r, \theta_r)$, we obtain the following relative dynamics:

\begin{equation}
\label{eq:5D_and_3D_rdyn}
\begin{aligned}
\left[
\begin{array}{c}
\dot x_r\\
\dot y_r\\
\dot\theta_r\\
\dot v\\
\dot \omega
\end{array}
\right]
=
\left[
\begin{array}{c}
- \hat v + v \cos \theta_r + \hat \omega y_r + d_x\\
v \sin \theta_r - \hat \omega x_r + d_y\\
\omega - \hat \omega \\
a\\
\alpha
\end{array}
\right].
\end{aligned}
\end{equation}

The Dubins car parameters are

The control bounds for the 5D car are $a \in []$, $|\alpha| < $.

The disturbance bound is $\|(d_x, d_y)\|_2 < $.

\MCnote{Show tracking error bound}

\MCnote{Online planning}

Our precomputed value function can serve as a tracking error bound, and its gradients form a look-up table for the optimal tracking controller. These can be combined with any planning algorithm such as MPC, RRT, or neural-network-based planners in a modular way. 

For our first example, we demonstrate the combination of fast planning and provably robust tracking by combining the fast sweeping method (FSM) \cite{} with our computed TEB. FSM is an efficient optimal control-based planner for car-like systems, and provides the globally optimal trajectory in real-time. We used a C implementation of FSM.

Besides planning a trajectory to the goal, the car must also sense obstacles in the vicinity. For illustration, we chose a simple virtual sensor that reveals obstacles within a range of ?? m.

Once an obstacle is sensed, the FSM planner replans the trajectory while taking into account all obstacles that have been sensed so far. 
To ensure that the quadrotor does not collide with the obstacles despite error in tracking, planning is done with respect to augmented obstacles that are ``expanded'' from the sensed obstacles by $\underline\valfunc$ in $(x,y)$ position space.

On an unoptimized MATLAB implementation on a desktop computer with a Core i7-2600K CPU, each iteration took approximately ?? ms on average. Most of this time is spent on planning: obtaining the tracking controller took approximately ?? ms per iteration on average. The frequency of control was once every ?? ms.

\MCnote{Fig. ?? shows the simulation results. 
Four time snapshots are shown. The initial position is $(-12, 0, 0)$, and the goal position is $(12, 0, 0)$. The top left subplot shows the entire trajectory from beginning to end. In all plots, a magenta star represents the position of the planning model; its movement is based on the paths planned by RRT, and is modeled by a 3D holonomic vehicle with a maximum speed. The blue box around the magenta star represents the tracking error bound.}