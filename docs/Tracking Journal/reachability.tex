% !TEX root = tracking.tex
\section{Robust-Invariant Region \label{sec:reachability}}
Goals overview: Compute invariant sets, given by the optimization solution

Properties of solution: 

\subsection{Trajectory Tracking as a Pursuit-Evasion Game}
Dynamics of system
\begin{equation}
\dot\vstate = \vdyn(\vstate, \vctrl, \dstb)
\end{equation}

Dynamics of trajectory
\begin{equation}
\dot\tstate = \tdyn(\tstate, \tctrl)
\end{equation}

Assume $\tstate$ is a subset of $\vstate$. Let $\tvind$ be the set of indices such that $\tstate_i = \vstate_{\tvind_i}$.

Relative state:
\begin{equation}
\rstate = \vstate - \tvmat\tstate
\end{equation}

Relative dynamics
\begin{equation}
\dot\rstate = \rdyn(\rstate, \vctrl, \tctrl, \dstb)
\end{equation}

Tracking error: $\rstate_{\tvind}$.

The goal of the system is to minimize the tracking error.

The goal of the trajectory, which is a ``virtual'' vehicle, is to maximize the tracking error.

\subsection{Optimization Problem}
Define an error function $\errfunc(\rstate)$

\begin{equation}
\valfunc(\rstate, T) = \max_{\vctrl(\cdot)} \min_{\tctrl(\cdot), \dstb(\cdot)} \min_{t \in [-T, 0]} \errfunc(\rtraj(0; \rstate, t, \vctrl(\cdot), \tctrl(\cdot), \dstb(\cdot))) 
\end{equation}

%Take $T \rightarrow \infty$:
%
%\begin{equation}
%\valfunc_\infty(\rstate) = \max_{\vctrl(\cdot)} \min_{\tctrl(\cdot), \dstb(\cdot)} \min_{t \le 0} \errfunc(\rtraj(0; \rstate, t, \vctrl(\cdot), \tctrl(\cdot), \dstb(\cdot))) 
%\end{equation}

\begin{thm}
Let $T_1 \ge 0$, and suppose

\begin{equation}
\label{eq:conv_valfunc}
\valfunc_\infty(\rstate) = \valfunc(\rstate, T) = \valfunc(\rstate, T_1) ~ \forall T > T_1.
\end{equation}

Then

\begin{equation}
\valfunc_\infty(\rstate) = \valfunc_\infty(\rtraj(t_2; \rstate, t_1, \vctrl^*(\cdot), \tctrl^*(\cdot), \dstb^*(\cdot))) ~ \forall t_1, t_2 \le 0.
\end{equation}

\noindent where
\begin{equation}
\begin{aligned}
\vctrl^*(\cdot) = \arg \max_{\vctrl(\cdot)} \min_{\tctrl(\cdot), \dstb(\cdot)} \min_{t \in [-T_1, 0]} \errfunc(\rtraj(0; \rstate, t, \vctrl(\cdot), \tctrl(\cdot), \dstb(\cdot))) \\
\tctrl^*(\cdot) = \arg \min_{\tctrl(\cdot)} \min_{\dstb(\cdot)} \min_{t \in [-T_1, 0]} \errfunc(\rtraj(0; \rstate, t, \vctrl(\cdot), \tctrl(\cdot), \dstb(\cdot))) \\
\dstb^*(\cdot) = \arg \min_{\dstb(\cdot)} \min_{t \in [-T_1, 0]} \errfunc(\rtraj(0; \rstate, t, \vctrl(\cdot), \tctrl(\cdot), \dstb(\cdot))) 
\end{aligned}
\end{equation}

\end{thm}

\begin{proof}
\eqref{eq:conv_valfunc} is equivalent to

\begin{equation}
\begin{aligned}
\max_{\vctrl(\cdot)} \min_{\tctrl(\cdot), \dstb(\cdot)} \min_{t \in [-T_1, 0]} \errfunc(\rtraj(0; \rstate, t, \vctrl(\cdot), \tctrl(\cdot), \dstb(\cdot))) \\
= \max_{\vctrl(\cdot)} \min_{\tctrl(\cdot), \dstb(\cdot)} \min_{t \in [-T, 0]} \errfunc(\rtraj(0; \rstate, t, \vctrl(\cdot), \tctrl(\cdot), \dstb(\cdot))) \\
\forall T > T_1
\end{aligned}
\end{equation}
\end{proof}

\begin{proof}
\begin{equation}
\begin{aligned}
\valfunc_\infty(\rstate) = \max_{\vctrl(\cdot)} \min_{\tctrl(\cdot), \dstb(\cdot)} \min_{t \in [-T, 0]} \valfunc_\infty(\rtraj(0; \rstate, t, \vctrl(\cdot), \tctrl(\cdot), \dstb(\cdot))) \\
\forall T \ge 0
\end{aligned}
\end{equation}

\end{proof}


\subsection{Dynamics of a Geometric Path}

\subsection{Solving the Optimization}

HJ Reachability (~1p)

Relative dynamics, setup, etc. (~1p)

Capture basin computation (~0.5p)